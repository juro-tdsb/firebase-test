<!DOCTYPE html>
<html>
<head>
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>

<body>
    <div id="main">
        <h3 id="heading">Test widget</h3>
        <span id="labelText"></span>
        <select id="myDropdown">
            <option value="">Select an option</option>
        </select>
    </div>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTVgkkmDeOuxb9TRLcnJrJ-vFkz6179OA",
            authDomain: "populate-dropdown-test.firebaseapp.com",
            databaseURL: "https://populate-dropdown-test-default-rtdb.firebaseio.com",
            projectId: "populate-dropdown-test",
            storageBucket: "populate-dropdown-test.appspot.com",
            messagingSenderId: "76589407412",
            appId: "1:76589407412:web:40a9394dd645eb20d44be1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const nameRef = ref(db, 'Sheet1/');

        onValue(nameRef, (snapshot) => {
            populateDropdown(snapshot);
        });

        function populateDropdown(snapshot) {
            const dropdown = document.getElementById("myDropdown");

            // Clear existing
            document.querySelectorAll('#myDropdown option').forEach(option => option.remove())

            snapshot.forEach((childSnapshot) => {
                const childData = childSnapshot.val().Name;
                const option = document.createElement("option");
                option.value = childData;
                option.text = childData;
                dropdown.appendChild(option);
            })
        }

    </script>

    <script type="text/javascript">
        //always subscribe to ready event and implement widget related code
        //inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function () {
            var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
            document.getElementById('labelText').innerHTML = label;
            //subscribe to form submit event
            JFCustomWidget.subscribe("submit", function () {
                var msg = {
                    //you should valid attribute to data for JotForm
                    //to be able to use youw widget as required
                    valid: true,
                    value: document.getElementById('myDropdown').value
                }
                // send value to JotForm
                JFCustomWidget.sendSubmit(msg);
            });
        });
    </script>
</body>
</html>
