<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="./styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <script src="//js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>

<body>
    <!-- <div id="main">
        <h3 id="heading">Test widget</h3>
        <span id="labelText"></span>
        <select id="myDropdown">
            <option value="">Select an option</option>
        </select>
    </div> -->
    <div id="dropdown-wrapper">
        <button id="dropdown-button" onclick="openDropdown()" class="dropbtn"><span id="button-text">Please select</span><span class="material-symbols-outlined">
        arrow_drop_down
        </span></button>
        <div id="dropdown" class="dropdown-content">
            <input type="text" placeholder="Search.." id="input" onkeyup="filterFunction()">
            <div id="dropdown-options" class="dropdown-options-wrapper">
                <!-- Options will be populated here -->
            </div>
        </div>
    </div>

    <script src="./script.js"></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js"

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCTVgkkmDeOuxb9TRLcnJrJ-vFkz6179OA",
            authDomain: "populate-dropdown-test.firebaseapp.com",
            databaseURL: "https://populate-dropdown-test-default-rtdb.firebaseio.com",
            projectId: "populate-dropdown-test",
            storageBucket: "populate-dropdown-test.appspot.com",
            messagingSenderId: "76589407412",
            appId: "1:76589407412:web:40a9394dd645eb20d44be1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const nameRef = ref(db, 'Sheet1/');
        var selectedValue = "";

        onValue(nameRef, (snapshot) => {
            populateDropdown(snapshot);
        });

        function populateDropdown(snapshot) {
            const dropdown = document.getElementById("dropdown-options");

            // Clear existing
            document.querySelectorAll('#dropdown-options span').forEach(option => option.remove())

            snapshot.forEach((childSnapshot) => {
                const childData = childSnapshot.val().Name;
                const option = document.createElement("span");
                option.innerHTML = childData;
                option.onclick =  function() {
                    document.getElementById("button-text").innerText = this.innerText;
                    selectedValue = this.innerText;
                    console.log(selectedValue);
                    document.getElementById("dropdown").classList.remove("show");

                }
                dropdown.appendChild(option);
            })
        }

        //always subscribe to ready event and implement widget related code
        //inside callback function , it is the best practice while developing widgets
        JFCustomWidget.subscribe("ready", function () {
            var label = JFCustomWidget.getWidgetSetting('QuestionLabel');
            document.getElementById('labelText').innerHTML = label;
            //subscribe to form submit event
            JFCustomWidget.subscribe("submit", function () {
                var msg = {
                    //you should valid attribute to data for JotForm
                    //to be able to use youw widget as required
                    valid: true,
                    value: document.getElementById("button-text").innerHTML
                }
                console.log(msg.value);
                // send value to JotForm
                JFCustomWidget.sendSubmit(msg);
            });
        });

    </script>

</body>
</html>
